# ğŸŒ blog-backend

## ğŸ“Œ í”„ë¡œì íŠ¸ ì†Œê°œ

**ê¸°ê°„: (2024.06 ~ .)**

#### ê³„ê¸°

ë‹¨ìˆœíˆ ì„¤ê³„ì™€ êµ¬í˜„ì—ë§Œ ì§‘ì¤‘í•˜ê³  ìˆì—ˆë‹¤ëŠ” ì‚¬ì‹¤ì„ ê¹¨ë‹«ê³ ,

ì§€ì†ì ìœ¼ë¡œ **ìš´ì˜ ë° ìœ ì§€ ë³´ìˆ˜í•  ìˆ˜ ìˆëŠ” í”„ë¡œì íŠ¸ì˜ í•„ìš”ì„±**ì„ ëŠê¼ˆìŠµë‹ˆë‹¤.

#### ëª©í‘œ

1. ì‹¤ì œ ì„œë¹„ìŠ¤ ìš´ì˜ì—ì„œ ê²ªì„ ìˆ˜ ìˆëŠ” ë¬¸ì œë“¤ì„ ì§ì ‘ ê²½í—˜í•´ë³´ê³  í•´ê²°í•  ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤.
2. ì§€ì†ì ìœ¼ë¡œ ì½”ë“œ í’ˆì§ˆ ê°œì„ í•©ë‹ˆë‹¤

## ğŸ“Œ ë§í¬

#### í”„ë¡œì íŠ¸ ë°°í¬ ì£¼ì†Œ

https://jongdeug.port0.org/

#### â­ Trouble Shooting ê¸°ë¡ â­

https://github.com/users/JongDeug/projects/9/views/3

#### ê¸°ëŠ¥ ê°œë°œ ê¸°ë¡

https://github.com/users/JongDeug/projects/9/views/1

#### Swagger ë°°í¬ ì£¼ì†Œ

https://jongdeug.port0.org/api/docs

## ğŸ“Œ ê¸°ìˆ  ìŠ¤íƒ

### v2

[![Nest.js](https://img.shields.io/badge/Nest.js-E0234E?style=for-the-badge&logo=nestjs&logoColor=white)](https://nestjs.com/)
[![Node.js](https://img.shields.io/badge/Node.js-339933?style=for-the-badge&logo=nodedotjs&logoColor=white)](https://nodejs.org/)
[![MySQL](https://img.shields.io/badge/MySQL-4479A1?style=for-the-badge&logo=mysql&logoColor=white)](https://www.mysql.com/)
[![Prisma](https://img.shields.io/badge/Prisma-2D3748?style=for-the-badge&logo=prisma&logoColor=white)](https://www.prisma.io/)
[![TypeScript](https://img.shields.io/badge/TypeScript-3178C6?style=for-the-badge&logo=typescript&logoColor=white)](https://www.typescriptlang.org/)
[![Docker](https://img.shields.io/badge/Docker-2496ED?style=for-the-badge&logo=docker&logoColor=white)](https://www.docker.com/)
[![Docker Compose](https://img.shields.io/badge/Docker_Compose-2496ED?style=for-the-badge&logo=docker&logoColor=white)](https://docs.docker.com/compose/)

### v1

[![Express](https://img.shields.io/badge/Express-000000?style=for-the-badge&logo=express&logoColor=white)](https://expressjs.com/)
[![Node.js](https://img.shields.io/badge/Node.js-339933?style=for-the-badge&logo=nodedotjs&logoColor=white)](https://nodejs.org/)
[![MySQL](https://img.shields.io/badge/MySQL-4479A1?style=for-the-badge&logo=mysql&logoColor=white)](https://www.mysql.com/)
[![Prisma](https://img.shields.io/badge/Prisma-2D3748?style=for-the-badge&logo=prisma&logoColor=white)](https://www.prisma.io/)
[![TypeScript](https://img.shields.io/badge/TypeScript-3178C6?style=for-the-badge&logo=typescript&logoColor=white)](https://www.typescriptlang.org/)
[![Redis](https://img.shields.io/badge/Redis-DC382D?style=for-the-badge&logo=redis&logoColor=white)](https://redis.io/)
[![Docker](https://img.shields.io/badge/Docker-2496ED?style=for-the-badge&logo=docker&logoColor=white)](https://www.docker.com/)
[![Docker Compose](https://img.shields.io/badge/Docker_Compose-2496ED?style=for-the-badge&logo=docker&logoColor=white)](https://docs.docker.com/compose/)

- **Express**: í•™ë¶€ ë•Œ ì‚¬ìš© ê²½í—˜ ìˆìŒ. ë¹ ë¥¸ API ê°œë°œ ê°€ëŠ¥.
- **NestJS**: ììœ ë„ê°€ ë†’ì€ Express ëŒ€ì‹  ëª¨ë“ˆí™” ë°©ì‹ êµ¬ì¡°ë¥¼ ìœ ë„í•˜ëŠ” NestJSë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜. ì½”ë“œ ê°€ë…ì„±ê³¼ ìœ ì§€ë³´ìˆ˜ì„± í–¥ìƒ ê¸°ëŒ€
- **Javascript**: í”„ë¡ íŠ¸ì—”ë“œì™€ ë°±ì—”ë“œ ëª¨ë‘ í•˜ë‚˜ì˜ ì–¸ì–´ë¡œ ê°œë°œ ê°€ëŠ¥
- **Typescript**: ì½”ë“œì˜ ì•ˆì „ì„±ê³¼ ìœ ì§€ ë³´ìˆ˜ í–¥ìƒ
- **Prisma**: TypeORMë³´ë‹¤ ì§ê´€ì ì¸ ìŠ¤í‚¤ë§ˆ ì‘ì„± ê°€ëŠ¥, ì¢€ ë” í¸ë¦¬í•˜ê²Œ ë°ì´í„°ë² ì´ìŠ¤ ê´€ë¦¬ ë° ì¿¼ë¦¬ ìˆ˜í–‰
- **MySQL**: ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„ ê²½í—˜ ì¶•ì  ëª©ì 
- **Swagger**: í•™ë¶€ íŒ€ í”„ë¡œì íŠ¸ì—ì„œ ê²½í—˜í•œ ëª…í™•í•œ ì†Œí†µì˜ í•„ìš”ì„±ì— ë”°ë¼ API ë¬¸ì„œí™” ë„êµ¬ ì ìš©

## ğŸ“Œ ì•„í‚¤í…ì²˜

#### ì „ì²´ì ì¸ ì„œë¹„ìŠ¤ êµ¬ì¡°

![image](https://github.com/user-attachments/assets/310ff036-2fc6-4af0-9ae2-34d85788a736)

## ğŸ“Œ API ëª…ì„¸ì„œ

| êµ¬ë¶„             | ê¸°ëŠ¥ëª…                 | HTTP Method | REST API                                   | JWT | ROLE(í•˜ìœ„ ë²”ì£¼) |
| ---------------- | ---------------------- | ----------- | ------------------------------------------ | --- | --------------- |
| 1. íšŒì› ê´€ë¦¬     | 1.1 ì´ë©”ì¼ ê°€ì…        | POST        | /auth/register                             | X   | ALL             |
|                  | 1.2 ë¡œê·¸ì¸             | POST        | /auth/login                                | X   | ALL             |
|                  | 1.3 ë¡œê·¸ì•„ì›ƒ           | GET         | /auth/logout                               | O   | USER            |
|                  | 1.4 ë¡œê·¸ì¸ ê°±ì‹         | GET         | /auth/token/refresh                        | O   | USER            |
|                  | 1.5 í† í° ë¬´íš¨í™”        | GET         | /auth/token/revoke/:id                     | O   | ADMIN           |
|                  | 1.6 ìœ ì € ëª©ë¡ ì¡°íšŒ     | GET         | /user                                      | O   | ADMIN           |
|                  | 1.7 ìœ ì € ìƒì„¸ ì¡°íšŒ     | GET         | /user/:id                                  | O   | ADMIN           |
|                  | 1.8 ìœ ì € ì‚­ì œ          | DELETE      | /user/:id                                  | O   | ADMIN           |
| 2. ê²Œì‹œê¸€ ê´€ë¦¬   | 2.1 ê²Œì‹œê¸€ ëª©ë¡ ì¡°íšŒ   | GET         | /post?search=&take=&draft=&cursor=&order[] | X   | ALL             |
|                  | 2.2 ê²Œì‹œê¸€ ìƒì„¸ ì¡°íšŒ   | GET         | /post/:id                                  | X   | ALL             |
|                  | 2.3 ê²Œì‹œê¸€ ë“±ë¡        | POST        | /post                                      | O   | ADMIN           |
|                  | 2.4 ê²Œì‹œê¸€ ìˆ˜ì •        | PATCH       | /post/:id                                  | O   | ADMIN           |
|                  | 2.5 ê²Œì‹œê¸€ ì‚­ì œ        | DELETE      | /post/:id                                  | O   | ADMIN           |
|                  | 2.6 ê²Œì‹œê¸€ ì¢‹ì•„ìš”      | POST        | /post/like/:id                             | X   | ALL             |
|                  | 2.7 ì´ë¯¸ì§€ ì—…ë¡œë“œ      | POST        | /common/image                              | O   | ADMIN           |
| 3. ëŒ“ê¸€ ê´€ë¦¬     | 3.1 ëŒ“ê¸€ ì‘ì„±(íšŒì›)    | POST        | /post/comment/user                         | O   | USER            |
|                  | 3.2 ëŒ“ê¸€ ìˆ˜ì •(íšŒì›)    | PATCH       | /post/comment/user/:id                     | O   | USER            |
|                  | 3.3 ëŒ“ê¸€ ì‚­ì œ(íšŒì›)    | DELETE      | /post/comment/user/:id                     | O   | USER            |
|                  | 3.4 ëŒ“ê¸€ ì‘ì„±(ë¹„íšŒì›)  | POST        | /post/comment/guest                        | X   | ALL             |
|                  | 3.5 ëŒ“ê¸€ ìˆ˜ì •(ë¹„íšŒì›)  | PATCH       | /post/comment/guest/:id                    | X   | ALL             |
|                  | 3.6 ëŒ“ê¸€ ì‚­ì œ(ë¹„íšŒì›)  | DELETE      | /post/comment/guest/:id                    | X   | ALL             |
| 4. íƒœê·¸ ê´€ë¦¬     | 4.1 íƒœê·¸ ëª©ë¡ ì¡°íšŒ     | GET         | /tag                                       | X   | ALL             |
|                  | 4.2 íƒœê·¸ ìƒì„¸ ì¡°íšŒ     | GET         | /tag/:id                                   | X   | ALL             |
|                  | 4.3 íƒœê·¸ ìƒì„±          | POST        | /tag                                       | O   | ADMIN           |
|                  | 4.4 íƒœê·¸ ìˆ˜ì •          | PATCH       | /tag/:id                                   | O   | ADMIN           |
|                  | 4.5 íƒœê·¸ ì‚­ì œ          | DELETE      | /tag/:id                                   | O   | ADMIN           |
| 5. ì¹´í…Œê³ ë¦¬ ê´€ë¦¬ | 5.1 ì¹´í…Œê³ ë¦¬ ëª©ë¡ ì¡°íšŒ | GET         | /category                                  | X   | ALL             |
|                  | 5.2 ì¹´í…Œê³ ë¦¬ ìƒì„¸ ì¡°íšŒ | GET         | /category/:id                              | X   | ALL             |
|                  | 5.3 ì¹´í…Œê³ ë¦¬ ìƒì„±      | POST        | /category                                  | O   | ADMIN           |
|                  | 5.4 ì¹´í…Œê³ ë¦¬ ìˆ˜ì •      | PATCH       | /category/:id                              | O   | ADMIN           |
|                  | 5.5 ì¹´í…Œê³ ë¦¬ ì‚­ì œ      | DELETE      | /category/:id                              | O   | ADMIN           |

## ğŸ“Œ ì‹œìŠ¤í…œ ìµœì í™”

### 1. ì‚¬ìš©ì ì¸ì¦ ì‹œìŠ¤í…œ

### ğŸ“œ ë¬¸ì œ

JWTë¥¼ ì´ìš©í•œ ì‚¬ìš©ì ì¸ì¦ ì‹œìŠ¤í…œì—ì„œ ì—¬ëŸ¬ ì´ìŠˆ ë°œìƒ:

- Refresh Tokenì„ ì„œë²„ DBì— ì €ì¥í•˜ëŠ” ì´ìœ ì— ëŒ€í•œ ê¶ê¸ˆì¦
- í´ë¼ì´ì–¸íŠ¸ì—ê²Œ JWT í† í°ì„ ì•ˆì „í•˜ê²Œ ì „ë‹¬í•˜ëŠ” ë°©ë²•

### â­ í•´ê²°

**1. í† í° ë¬´íš¨í™”**

- ì´ˆê¸° êµ¬í˜„: ì„œë²„ DBì— Refresh Token ì €ì¥ â†’ í† í° ë¬´íš¨í™” ê°€ëŠ¥
- ê°œì„ : ìºì‹œë¥¼ í™œìš©í•´ DB ì ‘ê·¼ì—†ì´ í† í° ë¬´íš¨í™”ê°€ ê°€ëŠ¥í•˜ë„ë¡ ë³€ê²½ â†’ ì„±ëŠ¥ ìµœì í™”.

**2. í† í° ìºì‹±**

- ì´ˆê¸° êµ¬í˜„: ìš”ì²­ë§ˆë‹¤ Access Token í† í° ê²€ì¦
- ê°œì„ : Access Tokenì„ ìºì‹±í•´ ê²€ì¦ëœ ìœ ì € ì‘ë‹µ ì‹œê°„ ë‹¨ì¶•

**3. í† í° ì „ì†¡ ë°©ì‹**

- ì¿ í‚¤ì— HttpOnly, SameSite, Secure ì†ì„±ì„ ì ìš©í•´ ì•ˆì „í•˜ê²Œ ì „ë‹¬.

### ğŸ”¥ ì„±ê³¼

**1. í† í° ë¬´íš¨í™”**

- íƒˆì·¨ ìœ„í—˜ì— ëŒ€ë¹„ ê°€ëŠ¥.

**2. ì„±ëŠ¥ ê°œì„ **

- Access Tokenì„ ì‚¬ìš©í•˜ëŠ” API ì‘ë‹µ ì‹œê°„: **37ms â†’ 7ms (ì•½ 81% ë‹¨ì¶•)**
- Refresh API ì‘ë‹µ ì‹œê°„: **95ms â†’ 73ms (ì•½ 23% ë‹¨ì¶•)**
- Logout API ì‘ë‹µ ì‹œê°„: **90ms â†’ 57ms (ì•½ 36% ë‹¨ì¶•)**

**3. ë³´ì•ˆ ê°•í™”**

- XSS, CSRF, Sniffing ê³µê²© ë°©ì–´ ê°€ëŠ¥.

---

### 2. ì´ë¯¸ì§€ ì—…ë¡œë“œ ë° ì²˜ë¦¬ ê°œì„ 

### ğŸ“œ ë¬¸ì œ

- ì´ˆê¸° êµ¬í˜„: ê²Œì‹œê¸€ Create APIì— ì´ë¯¸ì§€ ì—…ë¡œë“œ ê¸°ëŠ¥ í¬í•¨
- í”„ë¡ íŠ¸ì—”ë“œì™€ ì—°ê²°í•˜ëŠ” ê³¼ì •ì—ì„œ ì´ë¯¸ì§€ ì—…ë¡œë“œ ê¸°ëŠ¥ ê°œì„  í•„ìš”

### â­ í•´ê²°

**1. ì´ë¯¸ì§€ ì—…ë¡œë“œ API ë…ë¦½ì  ë¶„ë¦¬**

**2. Nginx ë„ì…**

- WAS(Wep Application Server)ì— ë„ë‹¬í•˜ê¸° ì „ì— Nginxì—ì„œ ì •ì  ì´ë¯¸ì§€ ì „ë‹¬

**3. Task Scheduling í™œìš©**

- í•˜ë£¨ë§ˆë‹¤ ì—…ë¡œë“œ ëœì§€ 24ì‹œê°„ì´ ì§€ë‚œ ì´ë¯¸ì§€ `temp` í´ë”ì—ì„œ ì‚­ì œ

### ğŸ”¥ ì„±ê³¼

- ê²Œì‹œê¸€ ì‘ì„± API ì‘ë‹µ ì‹œê°„ **72.16ms â†’ 22.96ms (ì•½ 68% ë‹¨ì¶•)**
- ê²Œì‹œê¸€ ì‘ì„± ì·¨ì†Œ ë° í˜ì´ì§€ ì´íƒˆ ì‹œ ë°œìƒí•˜ëŠ” ë¶ˆí•„ìš”í•œ ì´ë¯¸ì§€ ë¬¸ì œ í•´ê²°
- ì´ë¯¸ì§€ ë¡œë”© ì†ë„ í–¥ìƒ

---

### 3. í…ŒìŠ¤íŠ¸ ë° ë°°í¬

**1. í…ŒìŠ¤íŠ¸**

- ìœ ë‹› í…ŒìŠ¤íŠ¸, í†µí•© í…ŒìŠ¤íŠ¸, E2E í…ŒìŠ¤íŠ¸ ì§„í–‰
- ì½”ë“œì˜ ì‹ ë¢°ì„±ì„ ë†’ì´ê³  ë²„ê·¸ë¥¼ ë¹ ë¥´ê²Œ ë°œê²¬

**2. Docker ì‚¬ìš©**

- ë¼ì¦ˆë² ë¦¬íŒŒì´ì—ì„œ ë”°ë¡œ í™˜ê²½ ì„¸íŒ…ì„ í•˜ì§€ ì•Šê³ ë„ ì„œë²„ êµ¬ë™ ê°€ëŠ¥
- Multi-state builds ë¹Œë“œ ì ìš© **697MB â†’ 474MB (ì•½ 31% ì ˆê°)**

**3. CI/CD**

- Github Actionsë¥¼ í™œìš©í•´ í…ŒìŠ¤íŠ¸, ë¹Œë“œ, ë°°í¬ê°€ ìë™ìœ¼ë¡œ ì´ë¤„ì§€ëŠ” íŒŒì´í”„ë¼ì¸ êµ¬ì¶•
- ì½”ë“œ ë³€ê²½ ì‚¬í•­ì„ ìë™ìœ¼ë¡œ í”„ë¡œë•íŠ¸ í™˜ê²½ì— ë°°í¬í•  ìˆ˜ ìˆì–´ í¸ë¦¬

## ğŸ“Œ ERD ì„¤ê³„

```mermaid
erDiagram
"GuestComment" {
  Int id PK
  String nickName
  String email
  String password
  String guestId FK
}
"Guest" {
  Int id PK
  String guestId UK
}
"Category" {
  Int id PK
  String name UK
  DateTime createdAt
  DateTime updatedAt
}
"Comment" {
  Int id PK
  String content
  DateTime createdAt
  DateTime updatedAt
  Int parentCommentId FK "nullable"
  Int postId FK
  Int authorId FK "nullable"
  Int guestId FK "nullable"
}
"Image" {
  Int id PK
  String url
  Int postId FK
}
"PostLike" {
  Int postId FK
  String guestId FK
  DateTime createdAt
}
"Post" {
  Int id PK
  String title UK
  String content
  DateTime createdAt
  DateTime updatedAt
  Int prevId "nullable"
  Int nextId "nullable"
  Boolean draft
  String summary
  Int authorId FK
  Int categoryId FK
}
"Tag" {
  Int id PK
  String name UK
}
"User" {
  Int id PK
  String name
  String email UK
  String password
  Role role
  DateTime createdAt
}
"_PostToTag" {
  String A FK
  String B FK
}
"GuestComment" }o--|| "Guest" : guest
"Comment" }o--o| "Comment" : parentComment
"Comment" }o--|| "Post" : post
"Comment" }o--o| "User" : author
"Comment" |o--o| "GuestComment" : guest
"Image" }o--|| "Post" : post
"PostLike" }o--|| "Post" : post
"PostLike" }o--|| "Guest" : guest
"Post" }o--|| "User" : author
"Post" }o--|| "Category" : category
"_PostToTag" }o--|| "Post" : Post
"_PostToTag" }o--|| "Tag" : Tag
```

### `GuestComment`

ë¹„íšŒì› ëŒ“ê¸€ í…Œì´ë¸”

**Properties**

- `id`: Primary Key
- `nickName`: ë‹‰ë„¤ì„
- `email`: ì´ë©”ì¼
- `password`: ë¹„ë°€ë²ˆí˜¸(í•´ì‹œê°’)
- `guestId`
  > Foreign Key
  >
  > ì‘ì„±ì(ë¹„íšŒì›) ID [Guest.guestId](#Guest)

### `Guest`

ë¹„íšŒì› í…Œì´ë¸”

**Properties**

- `id`: Primary Key
- `guestId`: ë¹„íšŒì› id, í”„ë¡ íŠ¸ì—ì„œ ìƒì„±

### `Category`

ì¹´í…Œê³ ë¦¬ í…Œì´ë¸”

**Properties**

- `id`: Primary Key
- `name`: ì¹´í…Œê³ ë¦¬ ì´ë¦„
- `createdAt`: ìƒì„±ì¼
- `updatedAt`: ìˆ˜ì •ì¼

### `Comment`

ëŒ“ê¸€ í…Œì´ë¸”

**Properties**

- `id`: Primary Key
- `content`: ë‚´ìš©
- `createdAt`: ìƒì„±ì¼
- `updatedAt`: ìˆ˜ì •ì¼
- `parentCommentId`
  > Foreign Key
  >
  > ë¶€ëª¨ ëŒ“ê¸€ ID [Comment.id](#Comment)
- `postId`
  > Foreign Key
  >
  > ê²Œì‹œê¸€ ID [Post.id](#Post)
- `authorId`
  > Foreign Key
  >
  > ì‘ì„±ì(íšŒì›) ID [User.id](#User)
- `guestId`
  > Foreign Key
  >
  > ì‘ì„±ì(ë¹„íšŒì›) ID [GuestComment.id](#GuestComment)

### `Image`

ì´ë¯¸ì§€ í…Œì´ë¸”

**Properties**

- `id`: Primary Key
- `url`: ì´ë¯¸ì§€ url
- `postId`
  > Foreign Key
  >
  > ê²Œì‹œê¸€ ID [Post.id](#Post)

### `PostLike`

ë¹„íšŒì› <=> ê²Œì‹œê¸€ : ë‹¤ëŒ€ë‹¤, ê²Œì‹œê¸€ ì¢‹ì•„ìš” í…Œì´ë¸”

**Properties**

- `postId`
  > Foreign Key
  >
  > ê²Œì‹œê¸€ ID [Post.id](#Post)
- `guestId`
  > Foreign Key
  >
  > ë¹„íšŒì› ID [Guest.guestId](#Guest)
- `createdAt`: ì¢‹ì•„ìš”ê°€ ëˆŒë¦° ë‚ ì§œ

### `Post`

ê²Œì‹œê¸€ í…Œì´ë¸”

**Properties**

- `id`: Primary Key
- `title`: ì œëª©
- `content`: ë‚´ìš©
- `createdAt`: ìƒì„±ì¼
- `updatedAt`: ìˆ˜ì •ì¼
- `prevId`: ì´ì „ ê²Œì‹œê¸€ Id
- `nextId`: ë‹¤ìŒ ê²Œì‹œê¸€ Id
- `draft`: ì´ˆì•ˆ
- `summary`: ë‚´ìš© ìš”ì•½
- `authorId`
  > Foreign Key
  >
  > ì‘ì„±ì ID [User.id](#User)
- `categoryId`
  > Foreign Key
  >
  > ì‘ì„±ì ID [Category.id](#Category)

### `Tag`

íƒœê·¸ í…Œì´ë¸”

**Properties**

- `id`: Primary Key
- `name`: íƒœê·¸ ì´ë¦„

### `User`

íšŒì› í…Œì´ë¸”

**Properties**

- `id`: Primary Key
- `name`: ì´ë¦„
- `email`: ì´ë©”ì¼
- `password`: ë¹„ë°€ë²ˆí˜¸(í•´ì‹œê°’)
- `role`: ì—­í• 
- `createdAt`: ìƒì„±ì¼

### `_PostToTag`

Pair relationship table between [Post](#Post) and [Tag](#Tag)

**Properties**

- `A`:
- `B`:
